<%
  is_seller ||= false
  orders = orders.reverse if !$prod
  selected_order_status = pr[:order_status_type] || 'Any'
  if (selected_order_status!='Any')
    orders = orders.select {|o| o[:status] == selected_order_status}
  end
%>
<style>
.orders_top_list {
  zborder:1px solid red;
  width: 100%;
  justify-content: space-between;
  display: flex;
}
</style>
<h2 class='orders_top_list'> 
  <span>Orders </span>
<select onchange='filterOrders(this)'>
  <% (['Any'] + ORDER_STATUSES).each do |status| %>
    <option <%='selected' if selected_order_status == status %>><%= status %></option>
  <% end %>  
</select>
</h2>
<% if is_seller %>
<div>
  <button class='btn btn-raised btn-primary' type=button onclick=addOrder()>+ Add Order</button>
</div>
<% end %>

<div class='orders_list'>
<% orders.reverse.each do |o| %>  
  <%= erb :'orders/single_order', locals: {order: o, is_seller: is_seller} %>
<% end %>
</div>

  
<script>
function addOrder() {

  $.post('/enrolls').then(res => {
    if (res.err) alert(res.err);
    else $(res.html).hide().prependTo($('.orders_list')).fadeIn(1000);
    //else $('.orders_list').prepend(res.html);
    
  });
}

function updateOrderStatus(val, orderId) {
  $.post('/enrolls/'+orderId, {status: val}).then(()=>alert('updated'));
} 

function filterOrders(sel) {
  var val = $(sel).val();
  console.log(val);
  document.location = document.location+'&order_status_type='+val;
}
</script>